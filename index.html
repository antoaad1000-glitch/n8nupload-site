<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>n8nupload</title>
  <style>
    body{font-family:system-ui, Arial, sans-serif; margin:40px; max-width:860px}
    h1{margin-bottom:8px}
    .muted{color:#666}
    .row{display:flex; gap:12px; flex-wrap:wrap; margin:16px 0}
    button{padding:10px 14px; border:0; border-radius:8px; cursor:pointer; font-weight:600}
    .primary{background:#111; color:#fff}
    .ghost{background:#f1f1f1}
    #log{background:#0b0b0b; color:#cfe7cf; padding:12px; border-radius:8px; min-height:120px; white-space:pre-wrap}
    a{color:#0b57d0; text-decoration:none}
    a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <h1>n8nupload</h1>
  <p class="muted">This web app authenticates with TikTok and triggers an n8n workflow to upload a short vertical video via TikTok’s Content Posting API.</p>

  <div class="row">
    <!-- 1) LOGIN (OAuth) -->
    <button id="btnLogin" class="primary">Login with TikTok</button>

    <!-- 2) UPLOAD (Webhook → n8n) -->
    <button id="btnUpload" class="ghost">Upload Demo Video</button>
  </div>

  <h3>Review Notes</h3>
  <ul>
    <li>Product: <b>Login Kit</b> (OAuth) and <b>Content Posting API</b>.</li>
    <li>Scopes: <code>video.upload</code>, <code>video.publish</code>.</li>
    <li>Environment: Sandbox (demo only).</li>
  </ul>

  <p>
    <a href="./terms.html">Terms of Service</a> ·
    <a href="./privacy.html">Privacy Policy</a>
  </p>

  <h3>Demo Log</h3>
  <div id="log">Ready.</div>

  <script>
    // TODO: replace these two URLs with your real ones:
    const OAUTH_START_URL = "https://YOUR-N8N-DOMAIN/rest/oauth2-credential/callback/start?tiktok=1";
    // or if you prefer, send users directly to TikTok’s authorize URL that your n8n credential generates.

    const N8N_WEBHOOK_URL = "https://YOUR-N8N-DOMAIN/webhook/tiktok-demo-upload"; 
    // This should trigger your n8n workflow that:
    // - uses stored OAuth token
    // - uploads a small test MP4 to TikTok Sandbox
    // - publishes (private or draft)

    const log = (m) => {
      const el = document.getElementById("log");
      const time = new Date().toLocaleTimeString();
      el.textContent += `\n[${time}] ${m}`;
      el.scrollTop = el.scrollHeight;
    };

    document.getElementById("btnLogin").onclick = () => {
      log("Redirecting to TikTok OAuth (Login Kit)...");
      window.location.href = OAUTH_START_URL;
    };

    document.getElementById("btnUpload").onclick = async () => {
      log("Calling n8n webhook to upload demo video (Content Posting API)...");
      try {
        const resp = await fetch(N8N_WEBHOOK_URL, { method: "POST" });
        const txt  = await resp.text();
        log("n8n response: " + txt.slice(0, 400));
        if (!resp.ok) throw new Error("Upload failed: " + resp.status);
        log("Done. Check TikTok (Sandbox) for the uploaded video.");
      } catch (e) {
        log("Error: " + e.message);
      }
    };
  </script>
</body>
</html>
